"""Telegram bot handlers for {{ bot_name }}."""

import logging

from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

logger = logging.getLogger("{{ bot_name }}.handler")


async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Handle /start command."""
    logger.info("User %s started the bot", update.effective_user.id)
    await update.message.reply_text(
        "Hello! I'm {{ bot_name }}. {{ description }}\n"
        "Send me a message and I'll echo it back!"
    )


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Handle /help command."""
    await update.message.reply_text(
        "Available commands:\n"
        "/start - Start the bot\n"
        "/help - Show this help message"
    )


{% if "echo" in features %}
async def echo_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Echo back any text message."""
    text = update.message.text
    logger.debug("Echoing message from user %s", update.effective_user.id)
    await update.message.reply_text(text)
{% endif %}


def setup_handlers(app: Application) -> None:
    """Register all handlers on the application."""
    app.add_handler(CommandHandler("start", start_command))
    app.add_handler(CommandHandler("help", help_command))
    {% if "echo" in features %}
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo_message))
    {% endif %}
    logger.info("Handlers registered")
